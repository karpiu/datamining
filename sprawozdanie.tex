\documentclass[a4paper,12pt]{article}
\usepackage{graphicx}
\usepackage[polish]{babel}
%\usepackage[utf8]{inputenc}
\usepackage[cp1250]{inputenc} % to uzywamy na windowsie
%\usepackage[T1]{fontenc}
\usepackage[OT4]{fontenc} % to tez 
\usepackage{url}
\usepackage{hyperref}
\linespread{1.0}

\hyphenation{Eks-plo-ra-cji zwi¹-za-nych ka¿-de-go pew-nych Mo¿-na wszyst-kie}

\title{Regu³y asocjacyjne w analizie danych}

\author{K.~Król\\
M.~K.~Karpiñski\\
\\
Uniwersytet Wroc³awski\\
Instytut Informatyki\\
SPRAWOZDANIE Z PROJEKTU}

\date{Wroc³aw, dnia \today\ r.}

\begin{document}
\thispagestyle{empty}
\maketitle

\newpage

\tableofcontents

\newpage



\section{Wstêp}
\indent \indent Dokument ten zosta³ sporz¹dzony jako sprawozdanie do projektu z przedmiotu: Eksploracja Danych. Projekt ma na celu zbadanie danych ze œwiata rzeczywistego w poszukiwaniu ciekawych regu³ asocjacyjnych z nimi zwi¹zanych.

Kolejne rozdzia³y niniejszego sprawozdania zawieraj¹ opis sporz¹dzonych eksperymentów, pocz¹wszy od znalezionych danych i wykorzystanego oprogramowania, poprzez testy w³aœciwe, koñcz¹c krótkim podsumowaniem wykonanego zadania. 

\section{Dane}

\indent \indent Dane wykorzystane w projekcie zosta³y pobrane ze strony \url{http://repository.seasr.org/Datasets/UCI/arff/vote.arff}. Dane te 
zawieraj¹ g³osy ka¿dego z kongresmenów U.S. House of Representatives dotycz¹cych
16 istotnych problemów publicznych w roku 1984. Docelowo ten zbiór danych
wykorzystywano do klasyfikacji ludzi na demokratów/republikanów w zale¿noœci od stosunku do
podanych problemów:

\begin{enumerate}
\item handicapped-infants (wsparcie dla upoœledzonych noworodków)
\item water-project-cost-sharing (podzia³ kosztów dla gospodarki wodnej)
\item adoption-of-the-budget-resolution (akceptacja bud¿etu (rok 1984))
\item physician-fee-freeze (wstrzymanie wyp³at lekarzom)
\item el-salvador-aid (pomoc dla kraju El Salvador)
\item religious-groups-in-schools (grupy religijne w szko³ach)
\item anti-satellite-test-ban (zakaz prób militarnych w kwesti rakiet przeciwsatelitarnych)
\item aid-to-nicaraguan-contras (wsparcie dla partyzantów w Nikaragui)
\item mx-missile (budowa pocisku MX-Missile)
\item immigration (wsparcie dla imigrantów)
\item synfuels-corporation-cutback (zmniejszenie wydatków w Synfuels Corp.)
\item education-spending (wydawanie pieniêdzy na edukacjê)
\item superfund-right-to-sue (prawo do pozwania urzêdów pañstwowych w sprawie zwrotu kosztów za czyszczenie zanieczyszczonych terenów prywatnych)
\item crime (walka z przestêpszoœci¹)
\item duty-free-exports (bezc³owy eksport)
\item export-administration-act-south-africa (zakaz eksportu materia³ów militarnych do po³udniowej afryki)
\end{enumerate}

Liczba demokratów i republikanów kszta³towa³a siê nastêpuj¹co (demokraci - kolor niebieski, republikanie - kolor czerwony):
\begin{center}
\includegraphics[scale=1.0]{democrat&republican.png}
\end{center}

G³osy typu 'voted for', 'paired for', 'announced for' zosta³y sklasyfikowane jako g³osy 'yes',
'voted against', 'paired against', 'announced against' jako g³osy 'no', a g³osy 'voted present', 'voted present to avoid conflict of interest'
i brak g³osu zosta³y sklasyfikowane jako 'unknown' (oznaczone przez '?'). Poni¿ej widaæ tabele, na których oznaczone s¹ g³osy za i przeciw z podzia³em
na demokratów i republikanów (lewa kolumna - g³osy 'no', prawa kolumna - g³osy 'yes'):
\begin{center}
\includegraphics[scale=0.6]{voting.png}
\end{center}

Jak ju¿ wspomniano, danych tych u¿yto do klasyfikacji g³osuj¹cych. Mo¿na jednak spojrzeæ na te dane inaczej i spróbowaæ wyszukiwaæ pewnych tendencji w g³osowaniu na niektóre problemy. Chcemy dokonaæ tego poprzez wydobycie ciekawych regu³ asocjacyjnych zwi¹zanych z powy¿szymi danymi.

\section{Oprogramowanie}

\indent \indent Do wykonanie eksperymentów pos³u¿yliœmy siê programem wspomagaj¹cym eksploracjê danych WEKA dostêpnym na stronie: \url{http://www.cs.waikato.ac.nz/ml/weka/}.

\section{Algorytmy}

\indent \indent Wykorzystaliœmy niektóre algorytmy dostêpne w programie WEKA:

\begin{enumerate}
\item Apriori
\item FPGrowth
\item Tertius
\end{enumerate}

\subsection{Apriori}

Algorytm apriori by³ szeroko omawiany na wyk³adzie, dlatego te¿ pominiemy jego opis w niniejszej pracy.

\subsection{FPGrowth}

Algorytm FPGrowth korzysta z oszczêdnej (pod wzglêdem pamiêciowym) struktury FP-drzewa.
Definicja FP-drzewa:
\begin{itemize}
\item ukorzeniony, etykietowany graf acykliczny
\item korzeñ posiada etykietê 'null', pozosta³e wierzcho³ki reprezentuj¹ 1-elementowe zbiory czêste
\item ka¿dy wierzcho³ek zawiera ponadto liczbê transakcji wspieraj¹cych dany zbiór czêsty
\end{itemize}
Algorytm opiera siê na dwóch krokach:
\begin{enumerate}
\item Kompresja bazy danych $D$ i przekszta³cenie do FP-drzewa
\item Eksploracja FP-drzewa
\end{enumerate}
W $1$ kroku znajduje siê najpierw wszystkie $1$-elementowe zbiory czêste w bazie D. Nastêpnie,
ka¿d¹ tranksakcjê $T_i \in D$ zamienia siê na skompresowan¹ transakcjê $T_{r_i} \in D$ usuwaj¹c
z $T_i$ wszystkie elementy, które nie s¹ czêste. W ostatniej fazie, skompresowane transkacje s¹ sortowane
malej¹co po wartoœci wsparcia.
Nastêpnie konstruowane jest FP-drzewo:
\begin{enumerate}
\item utwórz korzeñ z etykiet¹ 'null'
\item Dla ka¿dej transakcji $T_{r_i}$ utwórz œcie¿kê w FP-drzewie. Transakcje o wspólnym prefiksie, wspó³dziel¹ istniej¹ce œcie¿ki.
W przypadku wyst¹pienia ró¿nicy, œcie¿ka jest rozdzielana. Ostatni wêze³ œcie¿ki zawiera liczbê transakcji wspieraj¹cych zbiór
elementów reprezentowany przez ca³¹ œcie¿kê.
\end{enumerate}
Ponadto przechowuje siê 'tablicê nag³ówków elementów', która to jest tablic¹ wskaŸników na poszczególne elementy w drzewie,
co przyspiesza i u³atwia przeszukiwanie drzewa.

W $2$ kroku, nastêpuje eksploracja uprzednio przygotowanego FP-drzewa. Porces ten opiera siê na obserwacji,
¿e dla ka¿dego $1$-elementowego zbioru czêstego $\alpha$, wszystkie czêste nadzbiory zbioru $\alpha$ s¹ reprezentowane
przez œcie¿kê zawieraj¹c¹ œcie¿kê dla $\alpha$.
Zatem eksploracja drzewa przebiega nastêpuj¹co:
\begin{enumerate}
\item Dla ka¿dego $1$-elementowego zbioru czêestego $\alpha$ znajdujemy wszystkie œcie¿ki w drzewie, które koñcz¹ siê wierzcho³kiem $\alpha$
\item Œcie¿k¹ prefiksow¹ wzorca $\alpha$ nazwiemy œcie¿kê, która koñczy siê wierzcho³kiem $\alpha$. Zbiór wszystkich œcie¿ek prefiksowych wzorca
tworzy warunkow¹ bazê wzorca. Na podstawie warunkowej bazy wzorca tworzymy warunkowe FP-drzewo wzorca $\alpha$: $Tree-\alpha$.
\item Nastêpnie wywo³ujemy siê rekurencyjnie dla drzewa $Tree-\alpha$ w celu znalezienia wszystkich zbiorów czêstych zawieraj¹cych $\alpha$.
\end{enumerate}

Konstrukcja FP-drzewa wymaga $O(|D|)$ czasu, natomiast $2.$ krok wymaga $O(|$tablica nag³ówków$|^2 \times $g³êbokoœæ FP-drzewa$)$.
W odró¿nieniu od $Apriori$, $FPGrowth$ nie wymaga za³adowania do pamiêci ca³ej bazy danych.

\subsection{Tertius}

\indent \indent Algorytm Tertius buduje regu³y z par atrybut-wartoœæ z danych treningowych oraz porz¹dkuje je wed³ug tego, jak bardzo s¹ wiarygodne - czyli ile razy regu³a uznana jest za prawdziw¹ w danych treningowych.

Regu³a sk³ada siê z cia³a (body) i g³owy (head). Cia³o zawiera warunki (litera³y) potrzebne do spe³nienia danej regu³y i mo¿e sk³adaæ siê z dowolnej liczby litera³ów. G³owa zawiera zdarzenie, które wystêpuje, gdy regu³a jest prawdziwa. Podczas wyszukiwania regu³, Tertius rozpoczyna od pustej regu³y - takiej, która zawiera puste cia³o i pust¹ g³owê. Regu³a jest nastêpnie udoskonalana poprzez dodawanie par atrybut-wartoœæ w kolejnoœci, w jakiej pojawiaj¹ siê w zbiorze danych. Gdy to nast¹pi, algorytm zlicza ile razy regu³a jest spe³niona (zarówno cia³o i g³owa s¹ prawdziwe) oraz ile razy regu³a daje wynik false-positive (gdy cia³o jest prawd¹, ale g³owa jest nieprawdziwa).

Jedn¹ z wad algorytmu Tertius jest jego wzglêdnie d³ugi czas pracy, który w du¿ej mierze zale¿y od liczby litera³ów w regu³ach. Zwiêkszenie dozwolonej liczby litera³ów zwiêksza czas pracy wyk³adniczo. Maj¹c $A$ atrybutów przyjmuj¹cych œrednio $V$ ró¿nych wartoœci, chc¹c wyszukiwaæ regu³y zawieraj¹ce litera³y d³ugoœci maksymalnie $n$, liczba mo¿liwych regu³ jest rzêdu $(AV)^n$.

\section{Analiza Danych}

\indent \indent Poni¿ej znajduje siê podsumowanie 7-miu (z ok. 50-ciu) testów wykonanych ró¿nymi algorytmami z ró¿nym stopniem parametryzacji. Po wykonaniu testów liczba znalezionych regu³ by³a zbyt du¿a, aby w czytelnej formie zaprezentowaæ je w niniejszej pracy. Dlatego pod ka¿dym z testów znajduje siê krótkie podsumowanie wraz kilkoma rêcznie wybranymi, ciekawymi (wed³ug autorów) regu³ami asocjacyjnymi.

Poni¿ej znajduje siê opis parametrów ka¿dego z algorytmów.

\begin{enumerate}
\item Apriori
  \begin{itemize}
    \item N : liczba najlepszych (wed³ug metryki) zwracanych regu³
    \item T : metryka (0=confidence; 1=lift; 2=leverage)
    \item C : minimalna wartoœæ metryki
    \item D : delta. Wartoœæ zmniejszaj¹ca min-support z ka¿d¹ iteracj¹ algorytmu
    \item U : górna granica min-support
    \item M : dolna granica min-support
  \end{itemize}
\item FPGrowth
  \begin{itemize}
    \item oprócz parametrów opisanych powy¿ej, dodano:
    \item I : maksymalna liczba elementów w zbiorach czêstych (-1=inf.)
  \end{itemize}
\item Tertius
  \begin{itemize}
    \item K : liczba najlepszych zwracanych regu³
    \item F : minimalna wiarygodnoœæ regu³
    \item N : szum. maksymalna proporcja instancji niespe³niaj¹cych danej regu³y
    \item L : maksymalna liczba litera³ów w regule
    \item G : gdzie negacja mo¿e wystêpowaæ w regu³ach (0=brak; 1=w ciele; 2=w g³owie; 3=w obu)
  \end{itemize}
\end{enumerate}

Wybór przedstawionych regu³ jest podyktowany przez najwy¿sze wartoœci metryki w danym teœcie. Dane regu³y mówi¹ o tendencji wyboru dla pewnych wa¿nych sytuacji spo³ecznych. Wiedza ta zakrawa o takie sfery jak psychika i moralnoœæ cz³owieka, dlatego aby poprawnie przeanalizowaæ przedstawione wyniki potrzebna jest wiedza z zakresu psychologii, socjologii i filozofii, której autorzy niniejszej pracy niestety nie posiadaj¹. Potrafimy jedynie dokonaæ suchej analizy danych, wskazuj¹c mocne powi¹zania pomiêdzy pewnymi problemami ¿ycia publicznego, jednak interpretacje tych wyników pozostawiamy ekspertom.

\subsection{Apriori 1}
\begin{itemize}
\item Parametry: -N 10 -T 0 -C 0.9 -D 0.05 -U 1.0 -M 0.1 
\item Metryka: confidence
\item Ciekawsze regu³y:
  \begin{itemize}
    \item (conf.=1.00) adoption-of-the-budget-resolution=y physician-fee-freeze=n $->$ Class=democrat
    \item (conf.=1.00) physician-fee-freeze=n aid-to-nicaraguan-contras=y $->$ Class=democrat
    \item (conf.=0.98) el-salvador-aid=n aid-to-nicaraguan-contras=y $->$ Class=democrat
  \end{itemize}
\item Wniosek: standardowy zestaw parametrów polecany przez program nie daje spodziewanych rezultatów. Otrzymaliœmy same regu³y klasyfikuj¹ce demokratów. Nie mniej jednak z otrzymanego zestawu regu³ mo¿na wydobyæ jak¹œ wiedzê: demokraci maj¹ podobne zdanie na temat niektórych problemów spo³ecznych. Republikanie bardziej ró¿ni¹ siê w swoich pogl¹dach.
\end{itemize}

\subsection{Apriori 2}
\begin{itemize}
\item Parametry: -N 10 -T 1 -C 1.1 -D 0.05 -U 1.0 -M 0.1
\item Metryka: lift
\item Ciekawsze regu³y:
  \begin{itemize}
    \item (lift=1.67) physician-fee-freeze=n $->$ Class=democrat
    \item (lift=1.67) Class=democrat $->$ physician-fee-freeze=n
    \item (lift=1.63) adoption-of-the-budget-resolution=y $->$ physician-fee-freeze=n
    \item (lift=1.63) physician-fee-freeze=n $->$ adoption-of-the-budget-resolution=y
  \end{itemize}
\item Wniosek: zmiana metryki i lekka zmiana parametrów zaowocowa³a dwoma nowymi wnioskami: pierwszy znów dotyczy klasyfikacji. Zauwa¿my, ¿e dwie pierwsze regu³y tworz¹ równowa¿noœæ. Dostajemy wiêc mocn¹ zale¿noœæ miêdzy problemem physician-fee-freeze a byciem demokrat¹. Drugi wniosek jest dla nas bardziej interesuj¹cy. Kolejne dwie regu³y równie¿ tworz¹ równowa¿noœæ, co daje nam mocn¹ zale¿noœæ miêdzy problemami adoption-of-the-budget-resolution a physician-fee-freeze.
\end{itemize}

\subsection{Apriori 3}
\begin{itemize}
\item Parametry: -N 20 -T 2 -C 0.1 -D 0.1 -U 1.0 -M 0.2
\item Metryka: leverage
\item Ciekawsze regu³y:
  \begin{itemize}
    \item (lev.=0.21) anti-satellite-test-ban=y physician-fee-freeze=n aid-to-nicaraguan-contras=y $->$ el-salvador-aid=n
    \item (lev.=0.18) el-salvador-aid=n $->$ physician-fee-freeze=n anti-satellite-test-ban=y aid-to-nicaraguan-contras=y
  \end{itemize}
\item Wniosek: zwiêkszenie liczby poszukiwanych regu³ oraz kolejna zmiana metryki da³y nam ciekawsze wyniki. 
\end{itemize}

\subsection{FPGrowth 1}
\begin{itemize}
\item Parametry: -P 2 -I -1 -N 10 -T 0 -C 0.9 -D 0.05 -U 1.0 -M 0.1
\item Metryka: confidence
\item Ciekawsze regu³y:
  \begin{itemize}
    \item (conf.=0.99) el-salvador-aid=y, Class=republican: $->$ physician-fee-freeze=y
    \item (conf.=0.98) crime=y, Class=republican: $->$ physician-fee-freeze=y
  \end{itemize}
\item Wniosek: zmiana algorytmu wyznaczy³a nam zmianê opcji politycznej. Algorytm FPGrowth preferuje regu³y zwi¹zanie z republikanami.
\end{itemize}

\subsection{FPGrowth 2}
\begin{itemize}
\item Parametry: -P 2 -I -1 -N 10 -T 1 -C 0.9 -D 0.05 -U 1.0 -M 0.1
\item Metryka: lift
\item Ciekawsze regu³y:
  \begin{itemize}
    \item (lift=1.58) crime=y $->$ religious-groups-in-schools=y
    \item (lift=1.58) adoption-of-the-budget-resolution=y $->$ aid-to-nicaraguan-contras=y
    \item (lift=1.53) aid-to-nicaraguan-contras=y $->$ adoption-of-the-budget-resolution=y
    \item (lift=1.53) el-salvador-aid=y $->$ religious-groups-in-schools=y
  \end{itemize}
\item Wniosek: z metryk¹ lift nasz algorytm wyzby³ siê regu³ posiadaj¹cych klasyfikator. Baza wiedzy poszerza siê o nowe regu³y.
\end{itemize}

\subsection{FPGrowth 3}
\begin{itemize}
\item Parametry: -P 2 -I -1 -N 10 -T 0 -C 0.9 -D 0.05 -U 1.0 -M 0.1
\item Metryka: conviction
\item Ciekawsze regu³y:
  \begin{itemize}
    \item (conv.=4.96) superfund-right-to-sue=y $->$ crime=y
    \item (conv.=3.62) mx-missile=y $->$ adoption-of-the-budget-resolution=y
    \item (conv.=3.53) religious-groups-in-schools=y, crime=y $->$ el-salvador-aid=y
    \item (conv.=3.30) mx-missile=y $->$ anti-satellite-test-ban=y
  \end{itemize}
\item Wniosek: zmiana parametrów oraz metryka conviction daje nam jeszcze wiêcej regu³.
\end{itemize}

\subsection{Tertius 1}
\begin{itemize}
\item Parametry: -K 10 -F 0.5 -C 0.5 -N 1.0 -L 5 -G 0
\item Ciekawsze regu³y:
  \begin{itemize}
    \item education-spending = n $->$ crime = n
    \item duty-free-exports = n $->$ aid-to-nicaraguan-contras = n
    \item el-salvador-aid = y and crime = y $->$ adoption-of-the-budget-resolution = n or physician-fee-freeze = y
    \item aid-to-nicaraguan-contras = y and Class = democrat $->$ physician-fee-freeze = n or mx-missile = y
  \end{itemize}
\item Wniosek: algorytm Tertius daje wiêcej mo¿liwoœci ni¿ poprzednie algorytmy. Zamiast zbiorów, po obu stronach implikacji znajduj¹ siê wyra¿enia boolowskie, co czyni wyszukane regu³y bardziej interesuj¹cymi.
\end{itemize}


\section{Podsumowanie}

\indent \indent Algorytmy wyszukuj¹ce regu³y asocjacyjnie niew¹tpliwie przydaj¹ siê do wydobywania wiedzy ze zgromadzonych danych. W wykorzystanym zbiorze zauwa¿yliœmy du¿¹ ró¿norodnoœæ znalezionych regu³ w zale¿noœci od uruchomionego algorytmu. Dlatego oczywistym wnioskiem (a tak¿e rad¹ na przysz³oœæ) jest: wykorzystanie kilku algorytmów na jednym zbiorze danych jest dobrym sposobem na uzyskanie ró¿norodnej wiedzy.

Kolejn¹ obserwacj¹, jak¹ wyci¹gnêliœmy z przeprowadzonych eksperymentów jest brak niektórych atrybutów w wynikowych regu³ach. Dla przyk³adu: w ¿adnej z regu³ nie pojawia siê problem imigrantów (mimo wielokrotnych powtórzeñ testów). Nie oznacza to, ¿e nie mo¿emy wyci¹gn¹æ z tego ¿adnej wiedzy. Wrêcz przeciwnie - oznacza to, ¿e nastawienie do problemu imigrantów jest niezale¿ne od innych problemów i opcji politycznej, do której dana osoba nale¿y.

\end{document}
